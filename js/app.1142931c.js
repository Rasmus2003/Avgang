(function(e){function t(t){for(var a,s,r=t[0],l=t[1],c=t[2],u=0,p=[];u<r.length;u++)s=r[u],i[s]&&p.push(i[s][0]),i[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var r=n[s];0!==i[r]&&(a=!1)}a&&(o.splice(t--,1),e=l(l.s=n[0]))}return e}var a={},s={app:0},i={app:0},o=[];function r(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-4edf4bfa":"92a418b9"}[e]+".js"}function l(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.e=function(e){var t=[],n={"chunk-4edf4bfa":1};s[e]?t.push(s[e]):0!==s[e]&&n[e]&&t.push(s[e]=new Promise(function(t,n){for(var a="css/"+({}[e]||e)+"."+{"chunk-4edf4bfa":"7078ae55"}[e]+".css",s=l.p+a,i=document.getElementsByTagName("link"),o=0;o<i.length;o++){var r=i[o],c=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(c===a||c===s))return t()}var u=document.getElementsByTagName("style");for(o=0;o<u.length;o++){r=u[o],c=r.getAttribute("data-href");if(c===a||c===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var a=t&&t.target&&t.target.src||s,i=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");i.request=a,n(i)},p.href=s;var d=document.getElementsByTagName("head")[0];d.appendChild(p)}).then(function(){s[e]=0}));var a=i[e];if(0!==a)if(a)t.push(a[2]);else{var o=new Promise(function(t,n){a=i[e]=[t,n]});t.push(a[2]=o);var c,u=document.getElementsByTagName("head")[0],p=document.createElement("script");p.charset="utf-8",p.timeout=120,l.nc&&p.setAttribute("nonce",l.nc),p.src=r(e),c=function(t){p.onerror=p.onload=null,clearTimeout(d);var n=i[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src,o=new Error("Loading chunk "+e+" failed.\n("+a+": "+s+")");o.type=a,o.request=s,n[1](o)}i[e]=void 0}};var d=setTimeout(function(){c({type:"timeout",target:p})},12e4);p.onerror=p.onload=c,u.appendChild(p)}return Promise.all(t)},l.m=e,l.c=a,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(n,a,function(t){return e[t]}.bind(null,a));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/rasmus2.0/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var p=0;p<c.length;p++)t(c[p]);var d=u;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"00ce":function(e,t,n){e.exports={locationInput:"LocationInput_locationInput_1Fmax",spinner:"LocationInput_spinner_2ic4d",resetLocationBtn:"LocationInput_resetLocationBtn_1OP_2",suggestions:"LocationInput_suggestions_3I4sW",withLabel:"LocationInput_withLabel_23-Ez",suggestion:"LocationInput_suggestion_3aHOF"}},"034f":function(e,t,n){"use strict";var a=n("c21b"),s=n.n(a);s.a},1436:function(e,t,n){"use strict";var a=n("3fa3"),s=n.n(a);s.a},1578:function(e,t,n){e.exports={updateAvailable:"UpdateAvailable_updateAvailable_uZAhH",updateAvailableActive:"UpdateAvailable_updateAvailableActive_1qO1M",reloadLink:"UpdateAvailable_reloadLink_10vaV",closeBtn:"UpdateAvailable_closeBtn_14n-V"}},"23f2":function(e,t,n){"use strict";var a=n("1578"),s=n.n(a);t["default"]=s.a},"2ede":function(e,t,n){e.exports={tripsTable:"TripsTable_tripsTable_seMaN",showingJourneyDetails:"TripsTable_showingJourneyDetails_2vlip",table:"TripsTable_table_2aCjV",tableHead:"TripsTable_tableHead_35rh1",trip:"TripsTable_trip_3L8k2",tripLine:"TripsTable_tripLine_1UetD",tripName:"TripsTable_tripName_1S77x",tripTime:"TripsTable_tripTime_MCuJO",tripNewTime:"TripsTable_tripNewTime_1TU8j",isLate:"TripsTable_isLate_332Tg",tripTrack:"TripsTable_tripTrack_hi4oT",tripNote:"TripsTable_tripNote_364hW",VT:"TripsTable_VT_zu_SE",TV:"TripsTable_TV_1mpPl",SL:"TripsTable_SL_1kF6p"}},"2f3b":function(e,t,n){"use strict";var a=n("b679"),s=n.n(a);t["default"]=s.a},"3fa3":function(e,t,n){},"55a3":function(e,t,n){"use strict";var a=n("2ede"),s=n.n(a);t["default"]=s.a},"56d7":function(e,t,n){"use strict";n.r(t);n("2dd2");var a=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("UpdateAvailable"),n("OfflineIndicator"),n("div",{staticClass:"build-info"},[e._v("build: "+e._s(e.buildTime))]),n("div",{staticClass:"top-nav"},[n("Tabs",{attrs:{tabs:e.tabs,"on-click":e.changeTab,"current-tab":e.currentTab}}),n("DigitalClock")],1),n("div",{staticClass:"container"},[n(e.currentTabComponent.componentName,e._b({tag:"component"},"component",e.currentTabComponent.props,!1))],1)],1)},i=[],o=n("c93e"),r=n("2f62"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{class:e.$style.informationPage},[e.isLoading?n("font-awesome",{class:e.$style.spinner,attrs:{icon:"spinner",spin:""}}):e._e(),n("div",{attrs:{id:e.gdocElementId}}),n("a",{class:e.$style.editLink,attrs:{href:e.editLink}},[e._v("Redigera")])],1)},c=[];n("4917"),n("a481"),n("28a5");const u="499673240843-8f8bn77590948esm040d5cl5s4k32hkq.apps.googleusercontent.com",p="AIzaSyAQVyCYvuXOxLcIMlT68G-ELLSxMVDqDGc",d=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],m=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.metadata.readonly"].join(" "),f={Datum:"date","Hållplats":"origin",Linje:"sname",Namn:"direction",Tid:"time","Ny tid":"rtTime","Läge":"track",Bakgrund:"fgColor"},h={infoDoc:{fileId:"1TRE1P4EmB3kwlURit8lICniBtRp7aqnhcU8x7D6yzqI",mimeType:"text/html"},manualDepartures:{fileId:"1XSzg87FgHsxUl6UqNfRJtYIkw8wyN0yB3RzIib3JsvM",mimeType:"text/tab-separated-values"}};let g,v,b=!1;async function y(){if(b)return;const e=document.createElement("script");e.addEventListener("load",()=>{b=!0,gapi.load("client:auth2",T)}),e.src="https://apis.google.com/js/api.js",document.body.appendChild(e)}const _=new Promise((e,t)=>{g=e,v=t}).then(()=>{if(gapi.auth2.getAuthInstance().isSignedIn.listen($),!gapi.auth2.getAuthInstance().isSignedIn.get())return gapi.auth2.getAuthInstance().signIn()});function T(){gapi.client.init({apiKey:p,clientId:u,discoveryDocs:d,scope:m}).then(g).catch(v)}function L(e){return y(),_.then(()=>D(h.infoDoc).then(t=>w(t,e)).catch(e=>console.error(e)))}function S(){return y(),_.then(()=>D(h.manualDepartures).then(({body:e})=>e).then(e=>{const t=e.split(/\n/),n=t[0].replace(/\n|\r/g,"").split(/\t/);return t.slice(1).map(e=>{const t=e.split(/\t/);return n.reduce((e,n,a)=>{const s=f[n]||n;return e[s]=t[a],e},{})})}))}function $(e){e||gapi.auth2.getAuthInstance().signIn()}function D(e){return gapi.client.drive.files.export(e)}function w(e,t){const n=e.body.match(/<body[^>]*>(.*)<\/body><\/html>$/)[1],a=document.getElementById(t);a.innerHTML=n}var k={init:y,printInfoDoc:L,getManualDepartures:S};const A="https://docs.google.com/document/d/1TRE1P4EmB3kwlURit8lICniBtRp7aqnhcU8x7D6yzqI/edit#";var I={name:"InformationPage",data(){return{isLoading:!0,gdocElementId:"gdoc",editLink:A}},mounted(){k.init(),k.printInfoDoc(this.gdocElementId).then(()=>this.isLoading=!1).catch(()=>this.isLoading=!1)}},j=I,O=n("979c"),C=n("2877");function N(e){this["$style"]=O["default"].locals||O["default"]}var E=Object(C["a"])(j,l,c,!1,N,null,null);E.options.__file="InformationPage.vue";var x=E.exports,J=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"digital-clock"},[e._v("\n  "+e._s(e.hours)+":"+e._s(e.minutes)+":"+e._s(e.seconds)+"\n")])},F=[];function M(e,t,n){let a;return n=n||this,(...s)=>{a&&clearTimeout(a),a=setTimeout(()=>e.apply(n,s),t)}}function B(e){return"none"!==window.getComputedStyle(e).display}var R={name:"DigitalClock",data(){return{intervalId:null,hours:"",minutes:"",seconds:""}},created(){this.handleResize=M(this.handleResize,250)},mounted(){this.updateDateTime(),this.startInterval(),this.handleResize(),window.addEventListener("resize",this.handleResize,!1)},beforeDestroy(){this.stopInterval(),window.removeEventListener("resize",this.handleResize,!1)},methods:{handleResize(){B(this.$el)?this.startInterval():this.stopInterval()},startInterval(){this.stopInterval(),this.intervalId=setInterval(this.updateDateTime,1e3)},stopInterval(){clearInterval(this.intervalId)},updateDateTime(){const e=new Date;this.hours=String(e.getHours()).padStart(2,"0"),this.minutes=String(e.getMinutes()).padStart(2,"0"),this.seconds=String(e.getSeconds()).padStart(2,"0")}}},P=R,U=(n("1436"),Object(C["a"])(P,J,F,!1,null,null,null));U.options.__file="DigitalClock.vue";var V=U.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{class:e.$style.stationInfo},[n("div",{class:e.$style.form},[n("LocationInput",{attrs:{disabled:e.initializing,label:"Hållplats"}})],1),e.location?n("TripsFilter",{attrs:{dict:e.dict}}):e._e(),n("div",{class:e.$style.content},[n("TripsTable",{attrs:{"from-to-label":e.fromToLabel}}),n("JourneyDetails")],1),e.location?n("footer",{class:e.$style.situations},[n("MessageCarousel",{attrs:{messages:e.situations.messages}})],1):e._e()],1)},H=[],q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.carousel},[n("div",{class:e.$style.items,style:{transform:"translateX("+e.translateX+")"},on:{touchstart:e.onTouchStart}},e._l(e.messages,function(t,a){return n("div",{key:a,class:e.$style.item},[e._v("\n      "+e._s(t)+"\n    ")])})),0===e.messages.length?n("div",{class:e.$style.item},[e._v("Inga trafikstörningar.")]):e._e(),n("div",{class:e.$style.dots},[n("button",{class:e.$style.playPauseBtn,on:{click:e.playPause}},[n("font-awesome",{attrs:{icon:["fas",e.intervalId?"pause":"play"]}})],1),e._l(e.messages,function(t,a){return n("button",{key:t,class:e.$style.dotBtn,on:{click:function(t){e.setActive(a)}}},[n("div",{class:[e.$style.dot,(s={},s[e.$style.activeDot]=e.active===a,s)]})]);var s})],2)])},G=[],Q={name:"MessageCarousel",props:{messages:{type:Array,default:()=>[]}},data(){return{active:0,intervalId:null,wait:5e3}},computed:{translateX(){return-100*this.active+"%"}},mounted(){this.play()},beforeDestroy(){this.pause()},methods:{setActive(e){this.pause(),this.active=e,this.play()},selectNextActive(){this.active=(this.active+1)%this.messages.length},play(){this.intervalId=setInterval(this.selectNextActive,this.wait)},pause(){clearInterval(this.intervalId),this.intervalId=null},playPause(){this.intervalId?this.pause():this.play()},onTouchStart(e){const t=e.target,n=e.changedTouches[0].clientX,a=e=>{t.removeEventListener("touchend",a);const s=e.changedTouches[0].clientX,i=n-s,o=Math.abs(i)>50;o&&(i>0?this.setActive((this.active+1)%this.messages.length):this.setActive(this.active>0?this.active-1:this.messages.length-1))};t.addEventListener("touchend",a)}}},K=Q,X=n("a55e");function Y(e){this["$style"]=X["default"].locals||X["default"]}var W=Object(C["a"])(K,q,G,!1,Y,null,null);W.options.__file="MessageCarousel.vue";var Z=W.exports,ee=function(){var e,t=this,n=t.$createElement,a=t._self._c||n;return a("aside",{class:[t.$style.journeyDetails,(e={},e[t.$style.display]=t.showJourneyDetails,e)]},[a("header",{class:t.$style.header},[a("h2",{class:t.$style.heading},[t._v("Detaljer")]),t.loadingJourneyDetails?a("font-awesome",{attrs:{icon:"spinner",spin:""}}):t._e(),a("button",{class:t.$style.closeBtn,on:{click:function(e){e.preventDefault(),t.setShowJourneyDetails(!1)}}},[t._v("✗")])],1),a("p",{class:t.$style.journeyMeta},[t.loadingJourneyDetails?t._e():a("span",[t._v("\n      "+t._s(t.journey.name)+" mot "+t._s(t.journey.direction)+"\n    ")]),a("a",{class:t.$style.mapLink,attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.setCurrentTab("Karta")}}},[t._v("Visa på karta")])]),t.loadingJourneyDetails?t._e():a("div",{class:t.$style.stopList},t._l(t.stops,function(e){return a("div",{key:e.depTime+e.name,class:[t.$style.stop,(n={},n[t.$style.stopPassed]=e.didPass,n)]},[a("div",{class:t.$style.stopDotCell},[a("div",{class:t.$style.stopDot})]),a("div",{class:t.$style.stopTime},[t._v("\n        "+t._s(e.rtDepTime||e.depTime)+"\n      ")]),a("div",{class:t.$style.stopName},[t._v(t._s(e.name))]),a("div",{class:t.$style.stopTrack},[t._v(t._s(e.track))])]);var n}))])},te=[],ne={name:"JourneyDetails",data(){return{now:Date.now(),timeoutId:null}},mounted(){this.timeoutId=setInterval(()=>{this.now=Date.now()},3e4)},beforeDestroy(){clearInterval(this.timeoutId)},computed:Object(o["a"])({},Object(r["e"])(["showJourneyDetails","loadingJourneyDetails","selectedJourney"]),{journey(){const e=this.selectedJourney;if(!e)return{};const t=[].concat(e.JourneyName);if(0===t.length)return{};const n=[].concat(e.Direction);return{name:t[0].name,direction:n[n.length-1].$}},stops(){const e=this.selectedJourney;return e?e.Stop.map(e=>{const t=new Date(`${e.depDate}T${e.depTime}`).getTime();return Object(o["a"])({},e,{didPass:t<this.now})}):[]}}),methods:Object(o["a"])({},Object(r["d"])(["setShowJourneyDetails"]),Object(r["d"])("tabs",["setCurrentTab"]))},ae=ne,se=n("67f8");function ie(e){this["$style"]=se["default"].locals||se["default"]}var oe=Object(C["a"])(ae,ee,te,!1,ie,null,null);oe.options.__file="JourneyDetails.vue";var re=oe.exports,le=function(){var e,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{class:[t.$style.locationInput,(e={},e[t.$style.withLabel]=t.label,e)],on:{focus:t.showDropDown,keyup:function(e){return"button"in e||!t._k(e.keyCode,"esc",27,e.key,"Escape")?t.hideDropDown(e):null}}},[a("label",[t._v("\n    "+t._s(t.label)+":\n    "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],attrs:{disabled:t.disabled,type:"search",placeholder:""},domProps:{value:t.searchText},on:{input:[function(e){e.target.composing||(t.searchText=e.target.value)},t.onInput],focus:t.showDropDown,blur:t.possiblyHideDropDown,keyup:[function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.selectFirstSuggestion(e):null},t.handleKeyInput]}}),t.isLoading?a("font-awesome",{class:t.$style.spinner,attrs:{icon:"spinner",spin:"","aria-hidden":"true"}}):t._e(),t.selectedLocation?a("Button",{class:t.$style.resetLocationBtn,attrs:{onClick:t.resetLocation,icon:"times"}}):t._e()],1),a("ul",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],class:t.$style.suggestions},[t.showUseMyLocation?a("li",{class:t.$style.suggestion,on:{keyup:t.handleKeyInput}},[a("button",{on:{click:function(e){return e.preventDefault(),t.getNearbyStops(e)}}},[a("font-awesome",{attrs:{icon:"crosshairs"}}),a("span",[t._v(" "+t._s(t.nearbyStopsMessage)+" ")]),t.isLoadingNearbyStops?a("font-awesome",{attrs:{icon:"spinner",spin:""}}):t._e()],1)]):t._e(),t._l(t.nearbyStops,function(e){return t.showNearbyStops?a("li",{key:e.name,class:t.$style.suggestion,on:{keyup:t.handleKeyInput}},[a("button",{on:{click:function(n){n.preventDefault(),t.onSelect(e)},keyup:function(n){if(!("button"in n)&&t._k(n.keyCode,"space",32,n.key," "))return null;t.onSelect(e)}}},[t._v(t._s(e.name))])]):t._e()}),!t.searchText||t.stops.length||t.isLoading?t._e():a("li",{class:t.$style.suggestion},[a("button",{on:{click:function(e){e.preventDefault()}}},[t._v("Inga resultat för söktermen")])]),t._l(t.stops,function(e){return a("li",{key:e.id,class:t.$style.suggestion,on:{keyup:t.handleKeyInput}},[a("button",{on:{click:function(n){n.preventDefault(),t.onSelect(e)},keyup:function(n){if(!("button"in n)&&t._k(n.keyCode,"space",32,n.key," "))return null;t.onSelect(e)}}},[t._v(t._s(e.name))])])})],2)])},ce=[],ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{class:[e.$style.button,e.className],attrs:{type:e.type,title:e.title},on:{click:function(t){return t.preventDefault(),e.onClick(t)}}},[e._v("\n  "+e._s(e.text)+"\n  "),e.icon?n("font-awesome",{attrs:{icon:["fas",e.icon]}}):e._e()],1)},pe=[],de={name:"Button",props:{className:{type:String,default:""},type:{type:String,default:"button"},title:{type:String,default:""},onClick:{type:Function,default:()=>{}},text:{type:String,default:""},icon:{type:String,default:null}}},me=de,fe=n("8f6b");function he(e){this["$style"]=fe["default"].locals||fe["default"]}var ge=Object(C["a"])(me,ue,pe,!1,he,null,null);ge.options.__file="Button.vue";var ve=ge.exports,be={name:"LocationInput",mounted(){this.debouncedFindStops=M(this.findStops,350,this),this.selectedLocation&&(this.searchText=this.selectedLocation.name,this.debouncedFindStops(this.selectedLocation.name))},components:{Button:ve},props:{label:{type:String,default:""},disabled:{type:Boolean,default:!1}},data(){return{show:!1,searchText:""}},computed:Object(o["a"])({},Object(r["c"])("api",["api"]),Object(r["c"])({isLoadingNearbyStops:"user/isLoading"}),Object(r["e"])("user",["nearbyStops","nearbyStopsError"]),Object(r["e"])("stops",["stops","isLoading"]),Object(r["e"])({userLocation:({user:e})=>e.location,selectedLocation:({trips:e})=>e.location}),{nearbyStopsMessage(){return this.isLoadingNearbyStops?"Hämtar närliggande hållplatser":this.nearbyStopsError||"Använd min plats"},showUseMyLocation(){return!this.searchText&&!this.nearbyStops.length},showNearbyStops(){return!this.searchText&&this.nearbyStops.length},hasSuggestions(){return this.stops.length||this.nearbyStops.length}}),watch:{selectedLocation(e){e||(this.searchText="")}},methods:Object(o["a"])({},Object(r["b"])("user",["getUserLocation","getNearbyStops"]),Object(r["b"])("stops",["findStops"]),Object(r["b"])("trips",["updateLocation"]),{onInput({target:{value:e}}){this.debouncedFindStops(e)},onSelect(e){this.searchText=e.name,this.updateLocation(e),this.hideDropDown(),this.findStops(e.name).then(this.hideDropDown)},selectFirstSuggestion(){0!==this.stops.length&&this.onSelect(this.stops[0])},handleKeyInput(e){const t={ArrowUp:"previousElementSibling",ArrowDown:"nextElementSibling"},n="button",a=n=>n.parentElement[t[e.key]];if(["ArrowDown","ArrowUp"].includes(e.key)&&this.show&&this.hasSuggestions){const e=this.$el.querySelector(`.${this.$style.suggestions} ${n}:focus`);if(e){const t=a(e);t&&t.querySelector(n).focus()}else this.$el.querySelector(`.${this.$style.suggestions} ${n}`).focus()}},showDropDown(){this.show=!0},hideDropDown(){this.show=!1,document.activeElement.blur()},possiblyHideDropDown(e){e.relatedTarget&&this.$el.contains(e.relatedTarget)||this.hideDropDown()},resetLocation(){this.updateLocation(null)}})},ye=be,_e=n("c11a");function Te(e){this["$style"]=_e["default"].locals||_e["default"]}var Le=Object(C["a"])(ye,le,ce,!1,Te,null,null);Le.options.__file="LocationInput.vue";var Se=Le.exports,$e=function(){var e,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{class:[t.$style.tripsTable,(e={},e[t.$style.VT]="VT"===t.apiName,e[t.$style.TV]="TV"===t.apiName,e[t.$style.SL]="SL"===t.apiName,e[t.$style.showingJourneyDetails]=t.showJourneyDetails,e)]},[a("table",{class:t.$style.table},[a("thead",{class:t.$style.tableHead},[a("tr",[a("th",[t._v(t._s(t.metaLabel))]),a("th",[t._v(t._s(t.fromToLabel))]),a("th",[t._v("Tid")]),a("th",{class:t.$style.tripNewTime},[t._v("Ny tid")]),a("th",[t._v(t._s(t.trackLabel))]),a("th",[t._v("Anm")])])]),a("tbody",{class:t.$style.tableBody},[a("tr",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}]},[a("td",{attrs:{colspan:"5"}},[t._v("\n          Hämtar trafikdata...\n          "),a("font-awesome",{attrs:{icon:"spinner",spin:""}})],1)]),t._l(t.trips,function(e){return a("tr",{key:e.id,class:[t.$style.trip],on:{click:function(n){t.getJourneyDetails(e)}}},[a("td",{class:t.$style.tripLine,style:{backgroundColor:e.fgColor,color:e.bgColor}},[t._v("\n          "+t._s(e.sname)+"\n        ")]),a("td",{class:t.$style.tripDest},[a("div",[a("span",{class:t.$style.tripName},[t._v("\n              "+t._s(e.direction||e.origin)+"\n            ")])]),a("div",{class:t.$style.tripVia},[e.via?a("small",[t._v(" via "+t._s(e.via))]):t._e()])]),a("td",{class:t.$style.tripTime},[a("span",{class:["only-mobile",(n={},n[t.$style.isLate]=e.isLate,n)]},[t._v(t._s(e.rtTime||e.time))]),a("span",{staticClass:"from-tablet"},[t._v(t._s(e.time))])]),a("td",{class:[t.$style.tripNewTime,t.$style.isLate]},[e.isLate?a("span",[t._v(t._s(e.rtTime))]):t._e()]),a("td",{class:t.$style.tripTrack},[t._v(t._s(e.track))]),a("td",{class:t.$style.tripNote},[e.cancelled?a("span",[t._v("Inställd")]):t._e()])]);var n}),a("tr",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading&&t.location&&0===t.trips.length,expression:"!isLoading && location && trips.length === 0"}]},[a("td",{attrs:{colspan:"5"}},[t._v("Inga resor att visa")])])],2)])])},De=[];const we="speechSynthesis"in window;let ke,Ae;function Ie(){ke=window.speechSynthesis.getVoices(),Ae=ke.find(e=>/Alva/i.test(e.name))}function je(e){if(we){var t=new SpeechSynthesisUtterance;t.text=e,t.volume=1,t.rate=.9,t.pitch=1,Ae?t.voice=Ae:console.log("Could not select voice"),window.speechSynthesis.speak(t)}}we&&Ie(),window.speechSynthesis.onvoiceschanged=Ie;var Oe={name:"TripsTable",props:{fromToLabel:{type:String,default:""}},mounted(){this.speak=M(this.speak,250,this)},computed:Object(o["a"])({},Object(r["e"])({showJourneyDetails:e=>e.showJourneyDetails,apiName:({api:e})=>e.name}),Object(r["e"])("trips",{isLoading:({isLoading:e})=>e,location:({location:e})=>e,doSpeak:({options:e})=>e.voice}),Object(r["c"])({trips:"trips/filteredTrips"}),Object(r["c"])("api",["dict"]),{metaLabel(){return this.dict.sname},trackLabel(){return this.dict.track}}),watch:{trips(e){this.speak(e)}},methods:Object(o["a"])({},Object(r["b"])(["getJourneyDetails"]),{speak(e){if(e.length<1||!this.doSpeak)return;const t=e[0],n=t.name,a=t.direction,s=t.timestamp,i=t.cancelled,o=e[0].via&&`via ${e[0].via},`||"",r=Math.ceil((s-Date.now())/6e4);je(i?`${n} mot ${a}, ${o} är inställd`:r<=0?`${n} mot ${a}, ${o} avgår nu`:1===r?`${n} mot ${a}, ${o} avgår om en minut`:r>1&&r<=60?`${n} mot ${a}, ${o} avgår om ${r} minuter`:`${n} mot ${a}, ${o} avgår om mer än en timma`)}})},Ce=Oe,Ne=n("55a3");function Ee(e){this["$style"]=Ne["default"].locals||Ne["default"]}var xe=Object(C["a"])(Ce,$e,De,!1,Ee,null,null);xe.options.__file="TripsTable.vue";var Je=xe.exports,Fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.tripsFilter},[n("div",{class:e.$style.filter},[n("font-awesome",{staticClass:"only-mobile",attrs:{icon:"filter"}}),n("span",{staticClass:"from-tablet"},[e._v("Filter:")])],1),n("div",{class:e.$style.filter},[n("select",{attrs:{name:"dest"},on:{change:e.updateFilter}},[n("option",{attrs:{value:""}},[e._v(e._s(e.fromToLabel))]),e._l(e.destinations,function(t){return n("option",{key:t,domProps:{selected:e.filter.dest===t,value:t}},[e._v(e._s(t))])})],2)]),n("div",{class:e.$style.filter},[n("select",{attrs:{name:"track"},on:{change:e.updateFilter}},[n("option",{attrs:{value:""}},[e._v("Läge")]),e._l(e.tracks,function(t){return n("option",{key:t,domProps:{selected:e.filter.track===t,value:t}},[e._v(e._s(t))])})],2)]),n("div",{class:e.$style.filter},[n("label",{class:e.$style.voice},[n("font-awesome",{attrs:{icon:["fas",e.options.voice?"volume-up":"volume-off"]}}),n("input",{class:e.$style.voiceCheckbox,attrs:{type:"checkbox",name:"voice"},domProps:{checked:e.options.voice},on:{input:e.updateOption}})],1)]),n("div",{class:e.$style.filter},[n("button",{class:e.$style.refreshBtn,attrs:{title:"Uppdatera"},on:{click:function(t){t.preventDefault(),e.getTrips()}}},[n("font-awesome",{attrs:{icon:"sync"}})],1)])])},Me=[];n("55dd"),n("ac6a");function Be(e,t){const n=Number(e)||e.charCodeAt(0),a=Number(t)||t.charCodeAt(0);return n<a?-1:n>a?1:0}function Re(e){if(!(e instanceof HTMLElement))throw Error("Argument must be HTMLElement");const t=e.nodeName,n=e.name;if("SELECT"===t)return{[n]:e.selectedOptions[0].value};if("INPUT"===t){const t=["checkbox","radio"].includes(e.type)?e.checked:e.value;return{[n]:t}}throw Error(`Unhandled node type: ${e.nodeName}`)}var Pe={name:"TripsFilter",props:{dict:{type:Object,default:()=>({})}},data(){return{radio:!1,timeSpans:[{value:"30",name:"30 min"},{value:"60",name:"1 timme"},{value:"120",name:"2 timmar"},{value:"180",name:"3 timmar"},{value:"360",name:"6 timmar"},{value:"720",name:"12 timmar"},{value:"1440",name:"24 timmar"}]}},computed:Object(o["a"])({},Object(r["e"])("trips",["filter","options"]),Object(r["c"])({trips:"trips/filteredTrips"}),{fromToLabel(){return this.dict.origDest},arriveDepartLabel(){return this.dict.arrEaves},destinations(){return Array.from(new Set(this.trips.map(({direction:e,origin:t})=>e||t)))},tracks(){const e=this.trips.map(({track:e})=>e).filter(e=>e).map(String);return Array.from(new Set(e)).sort(Be)}}),methods:Object(o["a"])({},Object(r["d"])("trips",["setFilter","setOptions"]),Object(r["b"])("trips",["getTrips"]),{updateFilter({target:e}){const t=Re(e);t&&this.setFilter(t)},updateOption({target:e}){const t=Re(e);t&&this.setOptions(t)}})},Ue=Pe,Ve=n("2f3b");function ze(e){this["$style"]=Ve["default"].locals||Ve["default"]}var He=Object(C["a"])(Ue,Fe,Me,!1,ze,null,null);He.options.__file="TripsFilter.vue";var qe=He.exports;const Ge={arrival:{arrEaves:"Ankommer",origDest:"Från"},departure:{arrEaves:"Avgår",origDest:"Till"}};var Qe={name:"StationInfo",components:{LocationInput:Se,JourneyDetails:re,TripsTable:Je,TripsFilter:qe,MessageCarousel:Z},props:{arrivals:{type:Boolean,default:!1}},computed:Object(o["a"])({},Object(r["e"])("trips",["location","situations"]),Object(r["e"])("api",{apiName:({name:e})=>e,initializing:({initializing:e})=>e}),Object(r["c"])("api",["api"]),{dict(){return this.arrivals?Ge.arrival:Ge.departure},show(){return!!this.trips.length},fromToLabel(){return this.arrivals?"Från":"Till"},arriveDepartLabel(){return this.arrivals?"Ankommer":"Avgår"}}),watch:{arrivals(e,t){e!==t&&this.location&&this.getTrips(this.location)},apiName(e,t){e!==t&&clearTimeout(this.lastTimeoutId)}},beforeDestroy(){clearTimeout(this.lastTimeoutId)},methods:Object(o["a"])({},Object(r["b"])("trips",["getTrips"]))},Ke=Qe,Xe=n("aeaf");function Ye(e){this["$style"]=Xe["default"].locals||Xe["default"]}var We=Object(C["a"])(Ke,z,H,!1,Ye,null,null);We.options.__file="StationInfo.vue";var Ze=We.exports,et=function(){var e,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{class:[t.$style.updateAvailable,(e={},e[t.$style.updateAvailableActive]=t.hasUpdate,e)]},[t._v("\n  🎉"),a("strong",[t._v("Uppdatering tillgänglig")]),t._v(" 🎉"),a("br"),a("a",{class:t.$style.reloadLink,attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.reload(e)}}},[t._v("Ladda om")]),t._v(" för att uppdatera 😆\n  "),a("Button",{attrs:{icon:"times",className:t.$style.closeBtn,onClick:t.closeUpdateToaster,title:"Stäng"}})],1)},tt=[],nt={name:"UpdateAvailable",components:{Button:ve},computed:Object(o["a"])({},Object(r["e"])({hasUpdate:e=>e.updateAvailable})),methods:Object(o["a"])({},Object(r["d"])(["setUpdateAvailable"]),{closeUpdateToaster(){this.setUpdateAvailable(!1)},reload(){window.location.reload()}})},at=nt,st=n("23f2");function it(e){this["$style"]=st["default"].locals||st["default"]}var ot=Object(C["a"])(at,et,tt,!1,it,null,null);ot.options.__file="UpdateAvailable.vue";var rt=ot.exports,lt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isOnline?e._e():n("div",{class:e.$style.offlineIndicator},[e._v("\n  Ingen internetanslutning 😥\n")])},ct=[],ut={name:"OfflineIndicator",computed:Object(o["a"])({},Object(r["e"])({isOnline:e=>e.online}))},pt=ut,dt=n("699f");function mt(e){this["$style"]=dt["default"].locals||dt["default"]}var ft=Object(C["a"])(pt,lt,ct,!1,mt,null,null);ft.options.__file="OfflineIndicator.vue";var ht=ft.exports,gt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{class:e.$style.tabs},e._l(e.tabs,function(t){return n("li",{key:t.name,class:[e.$style.tab,t.className,(a={},a[e.$style.tabSmall]=t.small,a[e.$style.tabActive]=e.currentTab===t.name,a[e.$style.tabDisabled]=t.disabled,a)]},[n("a",{class:e.$style.link,attrs:{title:t.name,href:"#"},on:{click:function(e){e.preventDefault(),t.onClick(t.name,t.props.arrivals)}}},[t.icon?n("font-awesome",{class:e.$style.onlyMobile,attrs:{icon:t.icon}}):e._e(),t.initializing?e._e():n("span",{class:(s={},s[e.$style.onlyDesktop]=t.icon,s)},[e._v("\n        "+e._s(t.name)+"\n      ")]),t.initializing?n("font-awesome",{attrs:{icon:"spinner",spin:""}}):e._e()],1)]);var a,s}))},vt=[],bt={name:"TabsComponent",props:{tabs:{type:Array,default:()=>[]},onClick:{type:Function,default:()=>{}},currentTab:{type:String,default:""}}},yt=bt,_t=n("6f5f");function Tt(e){this["$style"]=_t["default"].locals||_t["default"]}var Lt=Object(C["a"])(yt,gt,vt,!1,Tt,null,null);Lt.options.__file="Tabs.vue";var St=Lt.exports;const $t={icon:"",className:"",props:{arrivals:!1},onClick(){}},Dt=[{name:"Avgångar",componentName:"station-info"},{name:"Ankomster",componentName:"station-info",props:{arrivals:!0}},{name:"Karta",componentName:"map-component",icon:"map"},{name:"Info",componentName:"information-page",icon:"info-circle"}];var wt={name:"App",components:{MapComponent:()=>n.e("chunk-4edf4bfa").then(n.bind(null,"a0be")),Tabs:St,StationInfo:Ze,DigitalClock:V,UpdateAvailable:rt,InformationPage:x,OfflineIndicator:ht},data(){return{buildTime:"Sun, 28 Oct 2018 11:17:32 GMT",timeoutId:null}},mounted(){this.location&&this.getTripsAgainAndAgain()},computed:Object(o["a"])({},Object(r["e"])({apiName:({api:e})=>e.name,initializing:({api:e})=>e.initializing}),Object(r["e"])("tabs",["currentTab"]),Object(r["e"])("trips",["location"]),Object(r["c"])("api",["api"]),{tabs(){return[Object(o["a"])({},$t,{name:this.apiName,small:!0,onClick:this.toggleApi,initializing:this.initializing,className:this.apiName}),...Dt.map(e=>Object(o["a"])({},$t,e,{disabled:e.props&&e.props.arrivals&&"function"!==typeof this.api.getArrivalsTo,onClick:this.changeTab}))]},currentTabComponent(){return this.tabs.find(({name:e})=>e===this.currentTab)}}),watch:{location(e,t){e?e.id!==(t&&t.id)&&(clearTimeout(this.timeoutId),this.getTripsAgainAndAgain()):clearTimeout(this.timeoutId)},apiName(){"Ankomster"===this.currentTab&&"function"!==typeof this.api.getArrivalsTo&&this.setCurrentTab("Avgångar")}},methods:Object(o["a"])({},Object(r["d"])("trips",["setArrivals"]),Object(r["d"])("tabs",["setCurrentTab"]),Object(r["b"])("api",["toggleApi"]),Object(r["b"])("trips",["getTrips"]),{changeTab(e,t){this.setArrivals(t),this.setCurrentTab(e)},getTripsAgainAndAgain(){window.requestAnimationFrame(()=>{this.getTrips(),this.timeoutId=setTimeout(()=>this.getTripsAgainAndAgain(),3e4)})}})},kt=wt,At=(n("034f"),Object(C["a"])(kt,s,i,!1,null,null,null));At.options.__file="App.vue";var It=At.exports,jt=n("bfa9");const Ot='<LOGIN authenticationkey="2dfa6ea579bd45e3ac3810eb1a97adb6" />',Ct={},Nt={TrainStation({lat:e,long:t,name:n}={},a=500){return n?`\n        <FILTER>\n          <AND>\n            <LIKE name="AdvertisedLocationName" value="/^${n}/" />\n            <EQ name="Advertised" value="true" />\n          </AND>\n        </FILTER>\n      `:e&&t?`\n        <FILTER>\n          <AND>\n            <WITHIN name="Geometry.WGS84" shape="center" value="${t} ${e}" radius="${a}m" />\n            <EQ name="Advertised" value="true" />\n          </AND>\n        </FILTER>\n      `:"<FILTER />"},TrainMessage(e){return`\n      <FILTER>\n        <EQ name="AffectedLocation" value="${e}" />\n      </FILTER>\n    `},TrainAnnouncement(e){return`\n      <FILTER>\n        <AND>\n          <EQ name="Advertised" value="true" />\n          <EQ name="ActivityType" value="Avgang" />\n          <EQ name="LocationSignature" value="${e}" />\n          <GT name="AdvertisedTimeAtLocation" value="$dateadd(00:00:00)" />\n          <LT name="AdvertisedTimeAtLocation" value="$dateadd(05:00:00)" />\n        </AND>\n      </FILTER>\n    `}};function Et(e,...t){return fetch("https://api.trafikinfo.trafikverket.se/v1.3/data.json",{body:`\n      <REQUEST>\n        ${Ot}\n        <QUERY objecttype="${e}" ${"TrainAnnouncement"===e?'orderby="AdvertisedTimeAtLocation"':""}>\n          ${Nt[e](...t)}\n        </QUERY>\n      </REQUEST>\n    `,method:"POST",mode:"cors",headers:{"Content-Type":"text/xml"}}).then(e=>{const t=e.json().then(e=>e.RESPONSE.RESULT);return e.ok?t:t.then(e=>Promise.reject(e))}).then(t=>t[0][e]||[]).catch(e=>console.error(e))}function xt(e){return console.log(e||"No results"),e}function Jt(e){return Object.assign({},e,{name:e.AdvertisedLocationName,id:e.LocationSignature,region:"TV"})}function Ft({lat:e,lng:t}){return Et("TrainStation",{lat:e,long:t},5e3).then(e=>e.slice(0,5).map(Jt))}var Mt={init(){return Et("TrainStation").then(e=>e.forEach(e=>{Ct[e.LocationSignature]=e.AdvertisedLocationName}))},getClosestStops:Ft,getClosestStop(e){return Ft(e).then(e=>e[0])},getTrafficSituations(e){return Et("TrainMessage",e).then(xt).then(e=>({messages:e.map(({ExternalDescription:e})=>e)}))},getDeparturesFrom(e){return Et("TrainAnnouncement",e).then(e=>(e||[]).slice(0,30)).then(xt).then(e=>e.map(e=>Object(o["a"])({},e,{id:e.ActivityId,direction:e.ToLocation&&(Ct[e.ToLocation[0].LocationName]||""),via:e.ViaToLocation&&(Ct[e.ViaToLocation[0].LocationName]||""),name:`${e.ProductInformation.join(" ")}`,time:e.AdvertisedTimeAtLocation.substr(-8,5),timestamp:new Date(e.AdvertisedTimeAtLocation).getTime(),isLate:!1,track:e.TrackAtLocation,sname:e.ProductInformation[0]})))},findStops(e){return Et("TrainStation",{name:e}).then(e=>e.slice(0,15).map(Jt))},stationMap:Ct};const Bt="https://api.vasttrafik.se/bin/rest.exe/v2",Rt="https://api.vasttrafik.se/ts/v1/traffic-situations";let Pt,Ut;function Vt(e,t){const n=t?`${Rt}/${t}/${e}`:Rt;return Zt(n,{Accept:"application/json"}).then(e=>e.reduce((e,{title:t,description:n,affectedLines:a})=>({messages:e.messages.concat(`${t} ${n}`),affectedLines:[].concat(e.affectedLines,a.map(({designation:e})=>e)).filter(e=>e)}),{messages:[]}))}function zt(e,t){const n=new Date,a=n.toISOString().substr(0,10),s=n.toLocaleTimeString().substr(0,5),i=`${Bt}/trip?originId=${e}&destId=${t}&date=${a}&time=${s}&format=json`;return Zt(i).then(e=>an(e.TripList.Trip).map(e=>an(e.Leg)))}function Ht(e){const t=`${Bt}/location.name?input=${encodeURIComponent(e)}&format=json`;return Zt(t).then(e=>an(e.LocationList.StopLocation).slice(0,5)).then(e=>e.map(e=>Object.assign({},e,{region:"VT"})))}function qt(e){return e.map(e=>{const t=e.rtTime&&e.rtTime!==e.time,n=e.rtTime||e.time,a=e.rtDate||e.date,s=e.bgColor||"white",i=new Date(`${a}T${n}`).getTime();return Object.assign({},e,{region:"VT",cancelled:Boolean(e.cancelled),isLate:t,bgColor:s,timestamp:i})})}function Gt(e,t){const n=new Date,a=n.toISOString().substr(0,10),s=n.toLocaleTimeString().substr(0,5);let i=`${Bt}/arrivalBoard?id=${encodeURIComponent(e)}&date=${encodeURIComponent(a)}&time=${encodeURIComponent(s)}&format=json`;return t&&(i=`${i}&timeSpan=${t}`),Kt(e,i).then(e=>e.ArrivalBoard.Arrival).then(qt)}function Qt(e,t){let n=`${Bt}/departureBoard?id=${encodeURIComponent(e)}&format=json`;return t&&(n=`${n}&timeSpan=${t}`),Kt(e,n).then(e=>e.DepartureBoard.Departure||[]).then(e=>e.filter(({journeyid:t},n)=>!e.slice(0,n).some(e=>e.journeyid===t))).then(qt)}function Kt(e,t){return Zt(t).then(e=>{const t=e.error,n=e.errorText;return(t||n)&&console.error("[getTimeTable]",t||n),e})}function Xt({south:e,west:t,north:n,east:a}){const s=e=>Math.round(1e6*e),i=`${Bt}/livemap?minx=${s(t)}&miny=${s(e)}&maxx=${s(a)}&maxy=${s(n)}&onlyRealtime=yes`;return Zt(i).then(({livemap:e})=>e.vehicles)}function Yt(e){return Zt(e).then(({JourneyDetail:e})=>e)}function Wt(e){return Zt(e).then(({Geometry:e})=>e)}function Zt(e,t){const n=Promise.resolve(),a=Object(o["a"])({},t,{Authorization:`Bearer ${Pt}`});return(!Ut||Ut.getTime()<Date.now())&&(console.log("Need to update authtoken"),n.then(tn)),n.then(()=>fetch(e,{headers:a})).then(nn)}function en({lat:e,lng:t},n=5,a=!0){const s=`${Bt}/location.nearbystops?originCoordLat=${e}&originCoordLong=${t}&maxNo=${2*n}&format=json`;return Zt(s).then(e=>{if(e.LocationList.errorText)throw new Error(e.LocationList.errorText);return e.LocationList.StopLocation?e.LocationList.StopLocation.filter(({name:e},t,n)=>{const a=n.findIndex(t=>t.name===e);return a===t}).map(e=>Object(o["a"])({},e,{region:"VT"})).slice(0,n):[]}).catch(s=>{if(!a)throw console.error("[getClosestStops]",s),s;console.error("[getClosestStops]:",s,"retrying"),en({lat:e,lng:t},n,!1)})}function tn(){return fetch("https://api.vasttrafik.se:443/token",{headers:{Authorization:"Basic b1pZclV2c1ZGTG8zZ2FSemNaS0NUbEdJX21ZYTo4bTlLNnFsaDVNQXBWRFdRYlVWSUhneWZja3dh","Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:"grant_type=client_credentials"}).then(nn).then(e=>{return Pt=e.access_token,Ut=new Date(Date.now()+1e3*e.expires_in),console.log(`AuthToken expires ${Ut.toLocaleString()}`),e.access_token})}function nn(e){return e.ok?e.json():e.json().then(e=>Promise.reject(e))}function an(e){return e?[].concat(e):[]}const sn=tn();function on(){return sn}var rn={init:on,getClosestStop:e=>en(e,1),getClosestStops:en,findStops:Ht,getGeometry:Wt,getJourneyDetail:Yt,getTripSuggestion:zt,getDeparturesFrom:Qt,getArrivalsTo:Gt,getTrafficSituations:Vt,getLiveMap:Xt,transformTrips:qt};const ln="http://api.sl.se/api2",cn={method:"GET"},un={7:"gray",10:"#1C7F2A",11:"#1C7F2A",12:"gray",13:"#D51427",14:"#D51427",17:"#60A42B",18:"#60A42B",19:"#60A42B",21:"brown",22:"orange",25:"turquoise",26:"turquoise",27:"purple",28:"purple",29:"purple",40:"pink",41:"pink",42:"pink",43:"pink",44:"pink",45:"pink",48:"pink"};function pn(e){return un[e]||"#A4A5A7"}function dn(e){return Object(o["a"])({},e,{HafasId:e.id,id:e.id.substr(-4),region:"SL"})}function mn({lat:e,lng:t},n=5){const a="bf8e1f49392843a19e86ef1ccbaa15a0",s=`nearbystops.json?key=${a}&originCoordLat=${e}&originCoordLong=${t}&maxresults=${n}`;return Ln(s).then(e=>{const t=Array.from(e.LocationList.StopLocation);return t.map(dn)})}function fn(e){return mn(e,1)[0]}function hn(e){const t="76ea4bd8c1014b6490418de04bfd0b32",n=`typeahead.json?key=${t}&searchstring=${encodeURIComponent(e)}&maxresults=5`;return Ln(n).then(e=>Tn(e.ResponseData)).then(e=>e.filter((t,n)=>{const a=e.findIndex(({SiteId:e})=>e===t.SiteId);return a>=n}).slice(0,5).map(e=>Object(o["a"])({},e,{name:e.Name,id:e.SiteId,region:"SL"})))}const gn={BUS:"Buss",METRO:"T-bana",SHIP:"Båt",TRAIN:"Tåg",TRAM:"Spårvagn"};function vn(e){return gn[e]||e}function bn(e){const t="a312919085a9447d839109b9a6880d20",n=`realtimedeparturesV4.json?key=${t}&siteid=${e}&timewindow=30`;return Ln(n).then(e=>[...e.ResponseData.Buses,...e.ResponseData.Metros,...e.ResponseData.Ships,...e.ResponseData.Trains,...e.ResponseData.Trams].map(e=>Object(o["a"])({},e,{fgColor:pn(e.LineNumber),bgColor:"white",direction:e.Destination,timestamp:new Date(e.ExpectedDateTime||e.TimeTabledDateTime).getTime(),time:e.TimeTabledDateTime.substr(11,5),rtTime:e.ExpectedDateTime.substr(11,5),name:`${vn(e.TransportMode)} ${e.LineNumber}`,sname:e.LineNumber,track:e.StopPointDesignation||e.JourneyDirection,region:"SL",href:"#",isLate:e.TimeTabledDateTime!==e.ExpectedDateTime})))}function yn(e){const t="367eaa6107874c6e86bd985872f9cd46",n=`deviations.json?key=${t}&siteId=${e}`;return Ln(n).then(e=>Tn(e.ResponseData)).then(e=>{return{messages:e.map(({Details:e})=>e)}})}function _n(e){return e.ok&&204!==e.status?e.json():e.ok?(console.log("fetchMiddleware: not json and no error"),e):e.json().then(e=>Promise.reject(e))}function Tn(e){return e&&[].concat(e)||[]}function Ln(e){const t=`${ln}/${e}`,n=`https://request-proxy.herokuapp.com/?url=${encodeURIComponent(t)}`;return fetch(n,cn).then(_n).catch(e=>console.error(e))}var Sn={getClosestStop:fn,getClosestStops:mn,getDeparturesFrom:bn,getTrafficSituations:yn,findStops:hn,init(){return Promise.resolve()}};const $n={TV:{track:"Spår",sname:"Anmärkn."},VT:{track:"Läge",sname:"Linje"},SL:{track:"Läge",sname:"Linje"}};var Dn={VT:rn,TV:Mt,SL:Sn};const wn={isSupported:"geolocation"in navigator,isLoading:{location:!1,nearbyStops:!1},location:null,consented:null,nearbyStops:[],nearbyStopsError:""},kn={isLoading({isLoading:e}){return e.location||e.nearbyStops}},An={async getNearbyStops({commit:e,dispatch:t,state:n,rootState:a,rootGetters:s}){n.isSupported&&(n.location||await t("getUserLocation"),e("setLoading",{nearbyStops:!0}),s["api/api"].getClosestStops(n.location).then(t=>{console.log("nearbySyops",t),t&&t.length&&t[0].region===a.api.name?e("setNearbyStops",t):(e("setNearbyStopsError","Hittade ingen närliggande hållplats 😥"),setTimeout(()=>e("setNearbyStopsError",""),7e3)),e("setLoading",{nearbyStops:!1})}).catch(t=>{console.error(t),e("setLoading",{nearbyStops:!1}),e("setNearbyStopsError","Något gick snett 😱")}))},getUserLocation({commit:e,state:t}){return t.isSupported?(e("setLoading",{location:!0}),new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)}).then(t=>{e("setLoading",{location:!1}),e("setConsented",!0),e("setLocation",t.coords)}).catch(t=>{console.error(t),e("setLoading",{location:!1}),e("setConsented",!1)})):Promise.resolve()}},In={setLoading(e,t){e.isLoading=Object(o["a"])({},e.loading,t)},setConsented(e,t){e.consented=t},setLocation(e,t){e.location={lat:t.latitude,lng:t.longitude}},setNearbyStops(e,t){e.nearbyStops=t,e.nearbyStopsError=""},setNearbyStopsError(e,t){e.nearbyStopsError=t}};var jn={namespaced:!0,state:wn,getters:kn,actions:An,mutations:In},On=n("9393");const Cn=/\s*via\s*/;function Nn(e){if(Cn.test(e.direction)){const t=e.direction.split(Cn),n=Object(On["a"])(t,2),a=n[0],s=n[1];return Object.assign({},e,{direction:a,via:s})}return e}const En={track:"",dest:"",timeSpan:""},xn={messages:[],affectedLines:[]},Jn={isLive:!0,voice:!1},Fn=Object.keys(En),Mn=Object.keys(Jn),Bn={arrivals:!1,filter:Object(o["a"])({},En),options:Object(o["a"])({},Jn),trips:[],manualTrips:[],situations:Object(o["a"])({},xn),isLoading:!1,location:null},Rn={filteredTrips({trips:e,manualTrips:t,location:n,filter:a,situations:s}){const i=a.track,r=a.dest,l=s.affectedLines,c=void 0===l?[]:l,u=Date.now(),p=t.filter(({origin:e})=>n&&e===n.name).filter(({timestamp:e})=>e>u);return[...e,...p].map(e=>Object(o["a"])({},e,{isAffected:c.includes(e.sname)})).filter(e=>!i||e.track===i).filter(({direction:e,origin:t})=>!r||(e===r||t===r)).sort((e,t)=>e.timestamp-t.timestamp)}},Pn={loadManualDepartures({commit:e}){k.getManualDepartures().then(t=>{e("setManualTrips",Dn.VT.transformTrips(t))})},getTrips({commit:e,state:t,rootGetters:n},a=t.location){if(!a)return e("setTrips",[]);const s=t.arrivals?n["api/api"]["getArrivalsTo"]:n["api/api"]["getDeparturesFrom"];return e("setLoading",!0),s(a.id,t.filter.timeSpan).then(t=>{const n=t.map(Nn);console.log("[getTrips]",n),e("setTrips",n),e("setLoading",!1)}).catch(t=>{console.error("[getTrips]",t),e("setLoading",!1)})},getTrafficSituations({commit:e,rootGetters:t},n){return n?t["api/api"].getTrafficSituations(n.id,"stoparea").then(t=>{const n=t.messages.filter((e,t,n)=>!n.slice(0,t).some(t=>t===e));console.log("situations",t),e("setSituations",Object(o["a"])({},t,{messages:n}))}).catch(e=>console.error("[getTrafficSituations]",e)):e("setSituations",Object(o["a"])({},xn))},updateLocation({dispatch:e,commit:t,state:n},a){n.location!==a&&(console.log("[updateLocation]",a),t("setLocation",a),a?(e("getTrips",a),e("getTrafficSituations",a)):t("reset"))}},Un={reset(e){e.trips=[],e.filter=Object(o["a"])({},En),e.location=null,e.situations=Object(o["a"])({},xn)},setFilter(e,t){if(!Object.keys(t).every(e=>Fn.includes(e)))return console.error("[setFilter]","Non valid key(s) supplied, must be one of",Fn);e.filter=Object(o["a"])({},e.filter,t)},setOptions(e,t){if(!Object.keys(t).every(e=>Mn.includes(e)))return console.error("[setOptions]","Non valid key(s) supplied, must be one of",Mn);e.options=Object(o["a"])({},e.options,t)},setTrips(e,t){e.trips=t},setManualTrips(e,t){e.manualTrips=t},setSituations(e,t){e.situations=t},setLoading(e,t){e.isLoading=t},setLocation(e,t){e.location=t},setArrivals(e,t){e.arrivals=t}};var Vn={namespaced:!0,state:Bn,getters:Rn,actions:Pn,mutations:Un};const zn={stops:[],isLoading:!1},Hn={};let qn;const Gn={findStops({commit:e,rootGetters:t},n){return n?(qn=n,e("setLoading",!0),t["api/api"].findStops(n).then(t=>{return console.log("stops",t),qn===n?(e("setLoading",!1),e("setStops",t)):console.log("skipping response"),t}).catch(t=>{console.error(t),e("setLoading",!1)})):e("setStops",[])}},Qn={setStops(e,t){e.stops=t},setLoading(e,t){e.isLoading=t}};var Kn={namespaced:!0,state:zn,getters:Hn,actions:Gn,mutations:Qn};const Xn={currentTab:"Avgångar"},Yn={setCurrentTab(e,t){e.currentTab=t}};var Wn={namespaced:!0,state:Xn,mutations:Yn};const Zn=Object.keys(Dn),ea="VT";if(!Zn.includes(ea))throw new Error("defaultApi must exist");const ta=[],na={name:ea,initializing:!0},aa={api({name:e}){return Dn[e]},dict({name:e}){return $n[e]}},sa={setApi(e,t){e.name=t},setInitializing(e,t){e.initializing=t}},ia={initApi({commit:e,state:t}){console.info("initializing",t.name),e("setInitializing",!0),Dn[t.name].init().then(()=>{e("setInitializing",!1),ta.push(t.name)}).catch(t=>{console.error("[initApi]",t),e("setInitializing",!1)})},toggleApi({state:e,commit:t,dispatch:n}){const a=Zn.indexOf(e.name),s=(a+1)%Zn.length,i=Zn[s],o=ta.includes(i);t("setApi",i),t("trips/reset",null,{root:!0}),t("stops/setStops",[],{root:!0}),o||n("initApi")}};var oa={namespaced:!0,state:na,getters:aa,mutations:sa,actions:ia};a["a"].use(r["a"]);const ra=new jt["a"]({storage:window.localStorage,reducer:({trips:e,api:t})=>({trips:e,api:t})});var la=new r["a"].Store({strict:!1,state:{online:!0,selectedJourney:null,updateAvailable:!1,showJourneyDetails:!1,loadingJourneyDetails:!1},getters:{},mutations:{setOnline(e,t){e.online=t},setUpdateAvailable(e,t){e.updateAvailable=t},selectJourney(e,t){e.selectedJourney=t},setShowJourneyDetails(e,t){e.showJourneyDetails=t},setLoadingJourneyDetails(e,t){e.loadingJourneyDetails=t}},actions:{getJourneyDetails({commit:e,state:t},n){if("VT"!==t.api.name||!n.JourneyDetailRef)return console.log("[getJourneyDetails]","only available for VT"),Promise.resolve();e("setShowJourneyDetails",!0),e("setLoadingJourneyDetails",!0),Dn.VT.getJourneyDetail(n.JourneyDetailRef.ref).then(t=>{e("selectJourney",t),e("setLoadingJourneyDetails",!1)}).catch(t=>{console.error("[getJourneyDetails]",t),e("setLoadingJourneyDetails",!1)})}},modules:{api:oa,user:jn,trips:Vn,stops:Kn,tabs:Wn},plugins:[ra.plugin]}),ca=n("9483");la.commit("setOnline",navigator.onLine),window.addEventListener("offline",()=>la.commit("setOnline",!1)),window.addEventListener("online",()=>la.commit("setOnline",!0)),Object(ca["a"])("/rasmus2.0/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached(){console.log("Content has been cached for offline use.")},updated(){la.commit("setUpdateAvailable",!0),console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var ua=n("ecee"),pa=n("c074"),da=n("7a55");ua["library"].add(pa["e"],pa["g"],pa["i"],pa["j"],pa["a"],pa["f"],pa["c"],pa["h"],pa["l"],pa["k"],pa["d"],pa["b"]),a["a"].component("font-awesome",da["FontAwesomeIcon"]),a["a"].config.productionTip=!1,la.dispatch("api/initApi"),la.dispatch("trips/loadManualDepartures"),new a["a"]({store:la,render:e=>e(It)}).$mount("#app")},"67f8":function(e,t,n){"use strict";var a=n("add9"),s=n.n(a);t["default"]=s.a},"68f3":function(e,t,n){e.exports={informationPage:"InformationPage_informationPage_2JzFC",editLink:"InformationPage_editLink_3mh2I",spinner:"InformationPage_spinner_3mv-F"}},"699f":function(e,t,n){"use strict";var a=n("e713"),s=n.n(a);t["default"]=s.a},"6f5f":function(e,t,n){"use strict";var a=n("9dcf"),s=n.n(a);t["default"]=s.a},"8f6b":function(e,t,n){"use strict";var a=n("b313"),s=n.n(a);t["default"]=s.a},"979c":function(e,t,n){"use strict";var a=n("68f3"),s=n.n(a);t["default"]=s.a},"9dcf":function(e,t,n){e.exports={tabs:"Tabs_tabs_1QR2X",tab:"Tabs_tab_15Faw",tabSmall:"Tabs_tabSmall_3oxul",tabActive:"Tabs_tabActive_5B2qN",tabApi:"Tabs_tabApi_1DbIs",tabDisabled:"Tabs_tabDisabled_2LyC1",link:"Tabs_link_3QSdo",onlyDesktop:"Tabs_onlyDesktop_2idts",onlyMobile:"Tabs_onlyMobile_33MVU"}},a55e:function(e,t,n){"use strict";var a=n("c432"),s=n.n(a);t["default"]=s.a},aa4e:function(e,t,n){e.exports={stationInfo:"StationInfo_stationInfo_1Dt3D",form:"StationInfo_form_3BKgO",content:"StationInfo_content_3LXMa",situations:"StationInfo_situations_nDEmL"}},add9:function(e,t,n){e.exports={journeyDetails:"JourneyDetails_journeyDetails_3YAJj",display:"JourneyDetails_display_nRo1Q",header:"JourneyDetails_header_2FVDd",heading:"JourneyDetails_heading_1u5lY",closeBtn:"JourneyDetails_closeBtn_2AamI",journeyMeta:"JourneyDetails_journeyMeta_2_eYX",mapLink:"JourneyDetails_mapLink_1boUP",stopList:"JourneyDetails_stopList_2AU0a",stop:"JourneyDetails_stop_1ijip",stopDotCell:"JourneyDetails_stopDotCell_1gJ_N",stopDot:"JourneyDetails_stopDot_-Ig6N",stopPassed:"JourneyDetails_stopPassed_3heFC",stopTime:"JourneyDetails_stopTime_SRZYM",stopName:"JourneyDetails_stopName_1ry27",stopTrack:"JourneyDetails_stopTrack_1BnIw"}},aeaf:function(e,t,n){"use strict";var a=n("aa4e"),s=n.n(a);t["default"]=s.a},b313:function(e,t,n){e.exports={button:"Button_button_Mvymr"}},b679:function(e,t,n){e.exports={tripsFilter:"TripsFilter_tripsFilter_ZISik",filter:"TripsFilter_filter_1W5CS",voice:"TripsFilter_voice_3SGKu",voiceCheckbox:"TripsFilter_voiceCheckbox_2LW6X",refreshBtn:"TripsFilter_refreshBtn_YozBh"}},c11a:function(e,t,n){"use strict";var a=n("00ce"),s=n.n(a);t["default"]=s.a},c21b:function(e,t,n){},c432:function(e,t,n){e.exports={carousel:"MessageCarousel_carousel_2z3mA",playPauseBtn:"MessageCarousel_playPauseBtn_3CJmV",items:"MessageCarousel_items_36jYK",item:"MessageCarousel_item_18VK5",dots:"MessageCarousel_dots_33JNz",dotBtn:"MessageCarousel_dotBtn_hdtJx",dot:"MessageCarousel_dot_3Sbfj",activeDot:"MessageCarousel_activeDot_1Ti6v"}},e713:function(e,t,n){e.exports={offlineIndicator:"OfflineIndicator_offlineIndicator_RWCJm"}}});
//# sourceMappingURL=app.1142931c.js.map